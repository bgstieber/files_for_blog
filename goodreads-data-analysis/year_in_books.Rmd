---
title: 'My Year in Books: Goodreads Data Analysis'
author: "Brad Stieber"
date: ""
output: html_document
---

```{r echo = FALSE, message=FALSE, warning=FALSE, error=FALSE}
library(tidyverse)
library(lubridate)
library(scales)
theme_set(theme_bw())

goodreads_data <- read_csv("goodreads_library_export.csv") %>%
  mutate(`Number of Pages` = ifelse(grepl("Be a Player",
                                          Title),
                                    256, `Number of Pages`))

c_trans <- function(a, b, breaks = b$breaks, format = b$format) {
  a <- as.trans(a)
  b <- as.trans(b)

  name <- paste(a$name, b$name, sep = "-")

  trans <- function(x) a$trans(b$trans(x))
  inv <- function(x) b$inverse(a$inverse(x))

  trans_new(name = name, transform = trans, 
            inverse = inv, 
            breaks = breaks, format = format)
}

rev_date <- c_trans("reverse", "time")

```


In 2020, I set a goal of reading 30 books. Aided by a last minute charge, I was able to hit this number. I finished my 30th book on December 31 `r emo::ji("tada")`.

As I was finishing up my year of reading, I started thinking about some of the statistics of my year in books:

- How many pages, on average, was I reading per day?
- Did I have any slumps during the year? If so, how could the slumps be explained?
- What would be a reasonable "stretch goal" for 2021?

## Getting the Data

Getting Goodreads data isn't too difficult. They have a great export tool if you follow [this link](https://www.goodreads.com/review/import), you can export your library. Be warned that if you have a lot of books in your library, the export can take a long time. This export comes with `r ncol(goodreads_data)` columns, but for this analysis, the main columns I'm interested in are __Date Read__, __My Rating__ (what I rated the book, 0-5 stars), __Average Rating__, and __Number of Pages__, __Original Publication Year__. I added [my data](https://github.com/bgstieber/files_for_blog/blob/master/goodreads-data-analysis/goodreads_library_export.csv) to a [GitHub repository](https://github.com/bgstieber/files_for_blog/tree/master/goodreads-data-analysis). 

One thing that's missing from the Goodreads data export is the description of the book. I wrote a [python script](https://github.com/bgstieber/files_for_blog/blob/master/goodreads-data-analysis/scrape_goodreads.py) that uses [BeautifulSoup](https://www.crummy.com/software/BeautifulSoup/) to scrape Goodreads for this information. I don't use it in _this post_, but I could see using it in a different post down the road.

The data from Goodreads is mostly good to go, but there are a few tweaks to make before getting started.

```{r}
books_2020 <- goodreads_data %>%
  filter(year(`Date Read`) == 2020) %>%
  mutate(rating_diff = `My Rating` - `Average Rating`,
         publish_year = coalesce(`Original Publication Year`,
                                  `Year Published`)) %>%
  rename(date_read = `Date Read`,
         page_count = `Number of Pages`,
         avg_rating = `Average Rating`,
         my_rating = `My Rating`) %>%
  arrange(date_read) %>%
  mutate(previous_book_date = lag(date_read))
```


## Trends and Analysis

Here is the timeline of my year in books:

```{r echo = FALSE, fig.width=5.5, fig.height=8.5}
books_2020 %>%
    mutate(title_abbrev = 
             ifelse(nchar(Title) > 75,
                    paste0(substr(Title, 1, 75), "..."),
                    Title)) %>%
    ggplot(aes(as.POSIXct(date_read), 1, label = title_abbrev))+
    geom_text(size = 3)+
    scale_x_continuous("Date Finished", trans = rev_date)+
    coord_flip()+
    theme_minimal()+
    theme(axis.text.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.title.x = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank())+
    ggtitle("My Year in Books: 2020")
```

Even though this is a pretty basic data vis, I can find a few things that stand out to me:

- My sprint at the end of the year to get to thirty books
- A few books with longer read times: __The Remains of the Day__, __Never Let Me Go__, and __Be a Player__ (to a lesser extent)
  + These will come up again in calculating my 2021 goal
- Apart from the few books mentioned above, I had somewhat consistent read times for my 2020 books
  + What might be driving this?

In the code below, I create a `data.frame` with cumulative pages and books read by date.

```{r message = FALSE}
summary_by_date <- books_2020 %>%
  group_by(date_read, Title) %>%
  summarise(pages = sum(page_count),
            books = n()) %>%
  ungroup() %>%
  bind_rows(tibble(date_read = as.Date("2020-01-01"),
                   Title = NA_character_,
                   pages = 0,
                   books = 0)) %>%
  arrange(date_read) %>%
  mutate(previous_date = lag(date_read)) %>%
  mutate(days_since_last_book = as.numeric(difftime(
    date_read, previous_date, units = "days"
  ))) %>%
  mutate(cumu_pages_read = cumsum(pages),
         cumu_books_read = cumsum(books))
```

Using this data, I can look at my progress toward 30 books through the year.

```{r echo=FALSE}
summary_by_date %>%
    ggplot(aes(date_read, cumu_pages_read))+
    geom_line()+
    geom_text(aes(y = cumu_pages_read + 300, 
                  label = ifelse(cumu_books_read == 0,
                                 "", cumu_books_read)))+
    xlab("Date")+
    scale_y_continuous("Cumulative Pages Read",
                       labels = comma)+
    ggtitle("My Year in Books: Running Total of Pages Read in 2020")
```

```{r echo = FALSE, message = FALSE}
year_summary <- summary_by_date %>%
    filter(!is.na(previous_date)) %>%
    mutate(avg_pages = pages / days_since_last_book) %>%
    select(previous_date, date_read, pages, avg_pages) %>%
    rowwise() %>%
    mutate(actual_day = list(seq.Date(previous_date, date_read, by = "days"))) %>%
    unnest(actual_day) %>%
    mutate(month_grouping = ifelse(month(actual_day) <= 5, "Jan_May",
                                   ifelse(month(actual_day) <= 9, "Jun_Sep", 
                                          "Oct_Dec"))) 

month_summary_wide <- year_summary %>%
  group_by(month_grouping) %>%
  summarise(avg_pages = mean(avg_pages)) %>%
  pivot_wider(names_from = month_grouping, 
              values_from = avg_pages)

```

My reading certainly slowed down during the summer months. Most of this is due to me doing other things during a warm Wisconsin weather: playing golf and riding my bike. Between January and May I read an average of `r round(month_summary_wide$Jan_May, 1)` pages per day, between June and September, I read about `r round(month_summary_wide$Jun_Sep, 1)` pages per day, and finishing off the year, I read `r round(month_summary_wide$Oct_Dec, 1)` per day from October through the end of the year. 



< when are they from >

## 2021 Goal

< average pages per day >

what would happen if...

## Wrapping Up

Summary statistics:
